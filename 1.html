<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bible College - Internal Viewer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1e3c72; padding: 20px; color: #333; }
        .container { max-width: 1000px; margin: 0 auto; background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .header { background: #1e3c72; color: white; padding: 30px; text-align: center; border-bottom: 5px solid #ffd700; }
        .content { padding: 30px; }
        
        /* Form Styling */
        .login-box input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 6px; }
        
        /* Grid for Chapters */
        .pdf-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .pdf-card { border: 2px solid #1e3c72; padding: 25px; border-radius: 10px; text-align: center; cursor: pointer; transition: 0.3s; }
        .pdf-card:hover { background: #eef2f7; transform: translateY(-3px); }

        /* STRICT INTERNAL VIEWER */
        #pdfViewer { display: none; }
        .viewer-toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .iframe-container { 
            width: 100%; 
            height: 800px; 
            border: 4px solid #1e3c72; 
            border-radius: 8px; 
            background: #525659; 
        }
        iframe { width: 100%; height: 100%; border: none; }
        
        .btn { padding: 10px 20px; background: #1e3c72; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-print { background: #e67e22; }

        /* PRINT PROTECTION LOGIC */
        .print-shield { display: none; }

        @media print {
            /* Hide all UI elements */
            body * { visibility: hidden !important; }
            .header, .viewer-toolbar, .login-box, .pdf-cards { display: none !important; }

            /* Show ONLY the PDF area */
            #pdfViewer, #pdfViewer *, .iframe-container, iframe {
                visibility: visible !important;
                display: block !important;
            }

            /* The Shield: Designed to interfere with digital 'Save as PDF' drivers */
            .print-shield {
                display: block !important;
                visibility: visible !important;
                position: fixed;
                top: 0; left: 0;
                width: 100%; height: 100%;
                background: white;
                z-index: 10000;
                /* Some browsers render this over the digital PDF stream */
            }

            #pdfViewer { position: absolute; top: 0; left: 0; width: 100%; }
            .iframe-container { border: none !important; height: 100vh !important; }
        }
    </style>
</head>
<body>

<div class="print-shield"></div>

<div class="container">
    <div class="header">
        <h1>Bible College of India</h1>
        <p>Maharashtra Region Study Portal</p>
    </div>

    <div class="content">
        <div id="loginSection" class="login-box">
            <h2 style="text-align:center; margin-bottom:20px;">üîê Student Login</h2>
            <input type="email" id="studentEmail" name="studentEmail" placeholder="Enter your registered email" autocomplete="email">
            <button class="btn" style="width:100%" onclick="verifyAccess()">Access Materials</button>
            <p id="errorMsg" style="color:red; text-align:center; margin-top:10px; display:none;">Access Denied!</p>
        </div>

        <div id="pdfSelection" style="display:none;">
            <h2 style="margin-bottom:20px; border-left: 5px solid #ffd700; padding-left: 10px;">Select Chapter</h2>
            <div id="pdf-library-container" class="pdf-cards"></div>
        </div>

        <div id="pdfViewer">
            <div class="viewer-toolbar">
                <button class="btn" onclick="backToSelection()">‚¨ÖÔ∏è Back</button>
                <h3 id="currentPdfTitle"></h3>
                <button class="btn btn-print" onclick="handlePrint()">üñ®Ô∏è Print Paper</button>
            </div>
            <div class="iframe-container" id="iframeWrapper"></div>
        </div>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzEj-E6Xw9o7bSA6fLQ1AOvu93juU7b1ciNw7Ro0oWg2gnevgUuB4yfSNEutXKdfGoa/exec"; 
    const ALLOWED_EMAILS = { 'jlibiblecollege@gmail.com': 'Admin', 'p82158860@gmail.com': 'Pritee' };
    let PDF_DATA = [];

    // Helper to switch views
    function showSection(id) {
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('pdfSelection').style.display = 'none';
        document.getElementById('pdfViewer').style.display = 'none';
        document.getElementById(id).style.display = 'block';
    }

    async function loadLibrary() {
        const container = document.getElementById('pdf-library-container');
        try {
            const response = await fetch(SCRIPT_URL);
            const data = await response.json();
            PDF_DATA = data;
            container.innerHTML = '';
            data.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'pdf-card';
                card.onclick = () => openPDF(index);
                card.innerHTML = `<h3>üìñ ${item.title}</h3><p>Study Material</p>`;
                container.appendChild(card);
            });
        } catch (e) { container.innerHTML = "Error connecting to database."; }
    }

    function verifyAccess() {
        const email = document.getElementById('studentEmail').value.trim().toLowerCase();
        if (ALLOWED_EMAILS[email]) {
            showSection('pdfSelection');
            loadLibrary();
        } else {
            document.getElementById('errorMsg').style.display = 'block';
        }
    }

    function openPDF(index) {
        const item = PDF_DATA[index];
        if (!item || !item.url) return;

        showSection('pdfViewer');
        document.getElementById('currentPdfTitle').textContent = item.title;

        let fileId = "";
        if (item.url.includes('id=')) {
            fileId = item.url.split('id=')[1].split('&')[0];
        } else if (item.url.includes('file/d/')) {
            fileId = item.url.split('file/d/')[1].split('/')[0];
        }

        // ViewerNG is used for maximum internal compatibility
        const finalUrl = `https://drive.google.com/viewerng/viewer?embedded=true&url=${encodeURIComponent('https://docs.google.com/uc?export=download&id=' + fileId)}`;

        const wrapper = document.getElementById('iframeWrapper');
        if (wrapper) {
            wrapper.innerHTML = `<iframe src="${finalUrl}" allow="autoplay"></iframe>`;
        }
    }

    function handlePrint() {
        alert("Preparing for physical print. Note: 'Save as PDF' is restricted.");
        window.print();
    }

    function backToSelection() {
        showSection('pdfSelection');
        document.getElementById('iframeWrapper').innerHTML = ''; 
    }
</script>

</body>
</html>
